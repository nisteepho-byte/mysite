<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Financials — Ratios</title>
<link rel="stylesheet" href="../style.css" />
<style>
  .wrap{max-width:1000px;margin:90px auto 40px;padding:0 20px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}
  .card{background:var(--card);border:1px solid rgba(255,255,255,.1);border-radius:14px;padding:16px}
  .muted{color:var(--muted)}
  .big{font-size:28px;font-weight:700;margin:6px 0}
  .ok{color:#38d39f}.warn{color:#ffc74d}.bad{color:#ff6b6b}
</style>
</head>
<body class="dark">
<header class="site-wrap topbar" style="position:fixed;left:0;right:0;top:0">
  <a class="home" href="../index.html">⌂</a>
  <div class="links">
    <a href="./index.html">Overview</a>
    <a href="./statements.html">Statements</a>
    <a href="./ratios.html" style="border-bottom:1px solid currentColor">Ratios</a>
    <a href="./valuation.html">Valuation</a>
  </div>
</header>

<main class="wrap">
  <h1 id="title">Ratios</h1>
  <div class="grid" id="cards">Loading…</div>
</main>

<script src="./api.js"></script>
<script>
const tk = (new URLSearchParams(location.search).get('t')||'AAPL').toUpperCase();
document.getElementById('title').textContent = `${tk} — Ratios`;

function tone(v, goodHigh=true){ if (v==null) return ''; if (goodHigh) return v>0.25?'ok':v>0.15?'warn':'bad'; else return v<2.0?'ok':v<3.0?'warn':'bad'; }

async function load() {
  try {
    const [is, bs, cf, metrics] = await Promise.all([
      __FMP.income(tk,2), __FMP.balance(tk,2), __FMP.cashflow(tk,2), __FMP.keyMetrics(tk,2)
    ]);
    const i0=is?.[0], b0=bs?.[0], c0=cf?.[0], i1=is?.[1], b1=bs?.[1];
    const rev=i0?.revenue, op=i0?.operatingIncome, net=i0?.netIncome;
    const assets0=b0?.totalAssets, assets1=b1?.totalAssets;
    const equity0=b0?.totalStockholdersEquity, equity1=b1?.totalStockholdersEquity;
    const cfo=c0?.netCashProvidedByOperatingActivities, capex=c0?.capitalExpenditure;
    const at = rev && assets0 && assets1 ? rev/((assets0+assets1)/2) : null;
    const roe = net && equity0 && equity1 ? net/((equity0+equity1)/2) : null;
    const lev = assets0 && equity0 ? assets0/Math.max(equity0,0.0001) : null;
    const cards = [
      {t:"Operating Margin", v: rev? (op/rev):null, fmt:__FMP.pct, cls:v=>tone(v)},
      {t:"Net Margin", v: rev? (net/rev):null, fmt:__FMP.pct, cls:v=>tone(v)},
      {t:"FCF Margin", v: rev? ((c0?.netCashProvidedByOperatingActivities+(capex||0))/rev):null, fmt:__FMP.pct, cls:v=>tone(v)},
      {t:"Asset Turnover", v: at, fmt:v=>v?.toFixed(2)+'×', cls:v=>tone(v)},
      {t:"ROE", v: roe, fmt:__FMP.pct, cls:v=>tone(v)},
      {t:"Leverage (A/E)", v: lev, fmt:v=>v?.toFixed(2)+'×', cls:v=>tone(v,false)}
    ];
    document.getElementById('cards').innerHTML = cards.map(c=>`
      <div class="card">
        <p class="muted">${c.t}</p>
        <div class="big ${c.cls(c.v)}">${c.v==null?'—':c.fmt(c.v)}</div>
        <p class="muted">FY ${__FMP.ylab(i0?.date)}</p>
      </div>`).join('');
  } catch(e){
    document.getElementById('cards').innerHTML = `<p class="muted">Could not load ${tk}. Check API key/ticker.</p>`;
  }
}
load();
</script>
</body>
</html>
