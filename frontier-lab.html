<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Frontier Lab — Nick Isteepho</title>
<link rel="stylesheet" href="style.css"/>
<style>
  /* Page-scoped styles — uses your theme variables from style.css */
  .fl-wrap{max-width:1100px;margin:90px auto 48px;padding:0 20px}
  .grid{display:grid;gap:16px}
  @media (min-width:1000px){ .grid-2{grid-template-columns:380px 1fr} }
  .card{background:var(--card);border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:14px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .label{font-size:12px;color:var(--muted)}
  .input,.select{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.14);background:transparent;color:var(--fg)}
  body:not(.dark) .input, body:not(.dark) .select{border-color:#e6e7ef;color:#111}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid var(--accent);background:transparent;color:var(--fg);cursor:pointer}
  .btn.primary{background:var(--accent);color:#fff}
  .mini{font-size:12px;color:var(--muted)}
  .badge{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);padding:6px 10px;border-radius:999px;color:var(--muted);font-size:12px}
  .list{display:grid;gap:8px}
  .opt{display:grid;grid-template-columns:1.2fr repeat(4,1fr) auto;gap:8px}
  .opt input{width:100%}
  .kbar{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
  .k{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:10px}
  .k .t{color:var(--muted);font-size:12px}
  .k .v{font-weight:700;font-size:18px}
  .legend{display:flex;gap:12px;flex-wrap:wrap;margin-top:8px;color:var(--muted);font-size:12px}
  .dot{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:6px;background:var(--accent)}
  .dot.alt{opacity:.6}
  .chart{width:100%;height:360px;border:1px solid rgba(255,255,255,.12);border-radius:12px;overflow:hidden}
  .chart svg{width:100%;height:100%;display:block}
  .pill{padding:6px 10px;border:1px solid rgba(255,255,255,.18);border-radius:10px}
  .ok{color:#38d39f} .warn{color:#ffc34d} .bad{color:#ff6b6b}
  .home-icon:hover{background:rgba(255,255,255,.08);border-radius:50%}
  .table{width:100%;border-collapse:collapse;margin-top:8px}
  .table th,.table td{padding:8px 10px;border-top:1px solid rgba(255,255,255,.12)}
  .chip{display:inline-block;padding:2px 8px;border:1px solid rgba(255,255,255,.2);border-radius:999px;font-size:12px}
</style>
</head>
<body class="dark">
  <header class="wrap culinary-header">
    <a href="index.html" class="home-icon" title="Back to Home">⌂</a>
    <div class="header-text">
      <h1>Frontier Lab</h1>
      <p class="sub">Pick criteria. Score options. See the Pareto frontier and a robust recommendation.</p>
    </div>
  </header>

  <main class="fl-wrap grid grid-2">
    <!-- LEFT: Controls -->
    <aside class="card">
      <div class="row" style="justify-content:space-between">
        <div class="row">
          <span class="badge">Preset</span>
          <select id="preset" class="select">
            <option value="vendors" selected>Vendors (Cost/Speed/Quality/Risk)</option>
            <option value="plans">Plans (Price/Features/Reliability/Support)</option>
            <option value="hiring">Hiring (Comp/Skill/Speed/Culture)</option>
            <option value="custom">Custom (edit below)</option>
          </select>
        </div>
        <div class="pill mini">Green ↑ means better; for “lower-is-better” fields check the ↓ box.</div>
      </div>

      <h3 style="margin:10px 0 6px">Criteria (max 4)</h3>
      <div class="list" id="criteria">
        <!-- rows injected -->
      </div>
      <div class="row"><button id="addCrit" class="btn">+ Add Criterion</button></div>

      <h3 style="margin:12px 0 6px">Options</h3>
      <div class="list" id="options">
        <!-- rows injected -->
      </div>
      <div class="row"><button id="addOpt" class="btn">+ Add Option</button></div>

      <h3 style="margin:12px 0 6px">Weights</h3>
      <div class="row" id="weightsRow">
        <!-- sliders injected -->
      </div>
      <p class="mini">Weights auto-normalize. Toggle “Randomize 200” to see robustness across many weight draws.</p>

      <div class="row" style="margin-top:10px">
        <button id="calc" class="btn primary">Recalculate</button>
        <button id="random" class="btn">Randomize 200</button>
        <button id="reset" class="btn">Reset Preset</button>
      </div>
    </aside>

    <!-- RIGHT: Output -->
    <section class="grid">
      <div class="card">
        <div class="kbar">
          <div class="k"><div class="t">Recommended (current weights)</div><div class="v" id="k_best">—</div></div>
          <div class="k"><div class="t">Frontier size</div><div class="v" id="k_frontier">—</div></div>
          <div class="k"><div class="t">Robustness Win % (best)</div><div class="v" id="k_robust">—</div></div>
          <div class="k"><div class="t">Explained</div><div class="v" id="k_note">—</div></div>
        </div>
        <p class="mini" id="explainer" style="margin-top:8px">—</p>
      </div>

      <div class="card">
        <div class="legend">
          <span class="dot"></span><span>Pareto frontier (non-dominated)</span>
          <span class="dot alt"></span><span>Dominated</span>
          <span class="badge">Axes: Weighted Score (x) vs Balance (y)</span>
        </div>
        <div class="chart" id="chart">
          <svg viewBox="0 0 900 360" preserveAspectRatio="none">
            <g id="grid"></g>
            <g id="points"></g>
            <g id="labels"></g>
          </svg>
        </div>
      </div>

      <div class="card">
        <h3>Radar (Selected)</h3>
        <div class="chart" style="height:300px">
          <svg id="radar" viewBox="0 0 400 300" preserveAspectRatio="xMidYMid meet"></svg>
        </div>
        <p class="mini">Balance = how even an option is across criteria (higher is smoother, less lopsided).</p>
      </div>

      <div class="card">
        <h3>Table</h3>
        <table class="table" id="table"></table>
      </div>
    </section>
  </main>

<script>
/* ---------- Helpers ---------- */
const $ = (s,p=document)=>p.querySelector(s);
const $$ = (s,p=document)=>[...p.querySelectorAll(s)];
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const lerp=(a,b,t)=>a+(b-a)*t;
function normalizeWeights(ws){
  const sum = ws.reduce((a,b)=>a+Math.max(0,b),0)||1;
  return ws.map(w=>Math.max(0,w)/sum);
}
const rand=()=>Math.random();

/* ---------- Presets ---------- */
const PRESETS = {
  vendors:{
    criteria:[{name:'Cost', down:true},{name:'Speed',down:false},{name:'Quality',down:false},{name:'Risk',down:true}],
    options:[
      {name:'Alpha', vals:[70, 7.0, 8.5, 0.25]},
      {name:'Bravo', vals:[55, 5.5, 7.8, 0.35]},
      {name:'Citrus',vals:[90, 8.2, 9.2, 0.20]},
      {name:'Delta', vals:[60, 6.8, 8.0, 0.30]}
    ],
    hint:'Cost in $k, Speed in weeks, Quality 0–10, Risk probability 0–1.'
  },
  plans:{
    criteria:[{name:'Price', down:true},{name:'Features',down:false},{name:'Reliability',down:false},{name:'Support',down:false}],
    options:[
      {name:'Basic',   vals:[49, 5, 7.5, 6]},
      {name:'Plus',    vals:[79, 7, 8.5, 7]},
      {name:'Pro',     vals:[119,9, 9.2, 8]},
      {name:'Premium', vals:[149,10,9.5,9]}
    ],
    hint:'Price in $/mo, others 0–10.'
  },
  hiring:{
    criteria:[{name:'Comp',down:true},{name:'Skill',down:false},{name:'Speed',down:false},{name:'Culture',down:false}],
    options:[
      {name:'Candidate A', vals:[130, 8.8, 6.5, 8.0]},
      {name:'Candidate B', vals:[110, 8.2, 8.0, 7.5]},
      {name:'Candidate C', vals:[95,  7.9, 9.0, 7.0]},
      {name:'Candidate D', vals:[105, 8.6, 7.2, 9.2]}
    ],
    hint:'Comp in $k; others 0–10.'
  },
  custom:{
    criteria:[{name:'Criterion 1',down:false},{name:'Criterion 2',down:false}],
    options:[{name:'Option 1',vals:[5,6]},{name:'Option 2',vals:[7,4]}],
    hint:'Edit freely.'
  }
};

/* ---------- State ---------- */
let criteria = [];
let options = [];
let weights = [];
let currentPreset = 'vendors';
let selectedIndex = 0;

/* ---------- UI Builders ---------- */
function buildCriteriaUI(){
  const box = $('#criteria'); box.innerHTML='';
  criteria.forEach((c,i)=>{
    const row = document.createElement('div'); row.className='row';
    row.innerHTML = `
      <input class="input" style="flex:1" value="${c.name}" data-i="${i}" data-k="name"/>
      <label class="row mini"><input type="checkbox" ${c.down?'checked':''} data-i="${i}" data-k="down"/> lower is better (↓)</label>
      <button class="btn" data-i="${i}" data-act="delCrit">—</button>`;
    box.appendChild(row);
  });
}
function buildOptionsUI(){
  const box = $('#options'); box.innerHTML='';
  options.forEach((o,i)=>{
    const row = document.createElement('div'); row.className='opt';
    const cells = [
      `<input class="input" value="${o.name}" data-i="${i}" data-k="name"/>`,
      ...o.vals.map((v,j)=>`<input class="input" type="number" step="0.01" value="${v}" data-i="${i}" data-j="${j}" data-k="val"/>`),
      `<button class="btn" data-i="${i}" data-act="delOpt">—</button>`
    ].join('');
    row.innerHTML = cells;
    box.appendChild(row);
  });
  // header hint row
  if (!$('#optHeader')){
    const hdr = document.createElement('div'); hdr.id='optHeader'; hdr.className='row mini';
    hdr.innerHTML = `<span class="label">Columns: Name, ${criteria.map(c=>c.name).join(', ')}</span>`;
    box.prepend(hdr);
  } else {
    $('#optHeader').innerHTML = `<span class="label">Columns: Name, ${criteria.map(c=>c.name).join(', ')}</span>`;
  }
}
function buildWeightsUI(){
  const box = $('#weightsRow'); box.innerHTML='';
  weights = normalizeWeights(weights.length?weights:new Array(criteria.length).fill(1));
  criteria.forEach((c,i)=>{
    const w = document.createElement('div'); w.className='row';
    w.innerHTML = `<span class="label" style="width:90px">${c.name}</span>
      <input type="range" min="0" max="100" value="${Math.round(weights[i]*100)}" data-i="${i}"/>
      <span class="chip" id="w${i}">${(weights[i]*100).toFixed(0)}%</span>`;
    box.appendChild(w);
  });
}

/* ---------- Data transforms ---------- */
// Scale each criterion to [0,1], applying direction (down? invert)
function scale(options, criteria){
  const cols = criteria.length, rows = options.length;
  const vals = options.map(o=>o.vals.slice());
  // compute min/max per criterion
  const min = new Array(cols).fill(+Infinity);
  const max = new Array(cols).fill(-Infinity);
  for(let j=0;j<cols;j++){
    for(let i=0;i<rows;i++){
      const v = vals[i][j];
      if (v<min[j]) min[j]=v;
      if (v>max[j]) max[j]=v;
    }
    if (min[j]===max[j]){ max[j]=min[j]+1; } // avoid zero range
  }
  // scale
  const S = vals.map(row => row.map((v,j)=>{
    let t = (v - min[j])/(max[j]-min[j]);
    if (criteria[j].down) t = 1 - t;
    return clamp(t,0,1);
  }));
  return {S,min,max};
}
// Simple “balance” metric: 1 - stdev of scaled dims
function balance(scaledRow){
  const m = scaledRow.reduce((a,b)=>a+b,0)/scaledRow.length;
  const v = scaledRow.reduce((a,b)=>a+(b-m)*(b-m),0)/scaledRow.length;
  const sd = Math.sqrt(v);
  return clamp(1 - sd, 0, 1);
}
// Dominance: A dominates B if A ≥ B on all dims and > on at least one
function pareto(optionsScaled){
  const n = optionsScaled.length; const dom = new Array(n).fill(false);
  for(let i=0;i<n;i++){
    for(let j=0;j<n;j++){
      if (i===j) continue;
      const a = optionsScaled[i], b = optionsScaled[j];
      let ge=true, gt=false;
      for(let k=0;k<a.length;k++){ if (a[k] < b[k]) ge=false; if (a[k] > b[k]) gt=true; }
      if (ge && gt){ dom[j]=true; }
    }
  }
  const frontier = []; for(let i=0;i<n;i++){ if (!dom[i]) frontier.push(i); }
  return {dom, frontier};
}

/* ---------- Charts ---------- */
function drawScatter(scores, balances, frontierIdx, names){
  const svg = $('#chart svg'); const grid = $('#grid'); const points = $('#points'); const labels = $('#labels');
  const W=900,H=360,pad=34;
  grid.innerHTML=''; points.innerHTML=''; labels.innerHTML='';
  // axes (0..1)
  for(let i=0;i<=5;i++){
    const x = pad + (i/5)*(W-2*pad);
    const y = pad + (i/5)*(H-2*pad);
    const vx = document.createElementNS('http://www.w3.org/2000/svg','line');
    vx.setAttribute('x1',x); vx.setAttribute('x2',x); vx.setAttribute('y1',pad); vx.setAttribute('y2',H-pad);
    vx.setAttribute('stroke','currentColor'); vx.setAttribute('opacity','.12'); grid.appendChild(vx);
    const hy = document.createElementNS('http://www.w3.org/2000/svg','line');
    hy.setAttribute('x1',pad); hy.setAttribute('x2',W-pad); hy.setAttribute('y1',y); hy.setAttribute('y2',y);
    hy.setAttribute('stroke','currentColor'); hy.setAttribute('opacity','.12'); grid.appendChild(hy);
    const tx = document.createElementNS('http://www.w3.org/2000/svg','text');
    tx.setAttribute('x',x); tx.setAttribute('y',H-6); tx.setAttribute('font-size','12'); tx.setAttribute('text-anchor','middle');
    tx.textContent=(i/5).toFixed(1); grid.appendChild(tx);
    const ty = document.createElementNS('http://www.w3.org/2000/svg','text');
    ty.setAttribute('x',6); ty.setAttribute('y',H - (pad + (i/5)*(H-2*pad)) - 6); ty.setAttribute('font-size','12');
    ty.textContent=(i/5).toFixed(1)
